---
import SocialLinks from "@/components/molecules/social.astro";
import { ContactForm } from "@/components/react/contact-form";
import { ContactFormSchema as schema } from "@/lib/schema";
import { parse } from "@conform-to/zod";
import RootLayout from "../layouts/root.astro";

if (Astro.request.method === "POST") {
  try {
    const formData = await Astro.request.formData();

    const submission = parse(formData, { schema });

    if (!submission.value || submission.intent !== "submit") {
      throw submission.error;
    }

    const result = submission.value;

    const message = {
      to: "vansomecsam@gmail.com",
      from: result.email,
      replyTo: { email: result.email, name: result.name },
      subject: `Contact Form Submission From ${result.name}`,
      text: result.message,
    };

    console.log(message);
  } catch (e) {
    console.log("SUBMISSION_ERROR", e);
  }
}

const title = "Prince Muel - Contact Me";
const description =
  "Please feel free to reach out to me. I'd love to hear about what you're working on and how I could help.";
---

<RootLayout title={title} description={description}>
  <main id="main" aria-labelledby="page-heading" class="flex min-h-full flex-col gap-20 py-20">
    <h1 id="page-heading" class="sr-only">Want to reach out?</h1>

    <section class="container">
      <div
        class="flex flex-col gap-8 border-y border-zinc-800/20 py-12 dark:border-zinc-200/20 md:flex-row"
      >
        <h2 class="flex-1 text-4xl font-semibold tracking-tight text-blue-600">Get in Touch</h2>

        <div class="flex flex-1 flex-col gap-6">
          <p>
            Hi there! Thanks for sticking with me till this point. If you're looking for a fast,
            performant, user-friendly, SEO and accessibility compliant website to represent your
            product or business, want a consultation or you'd just like to say hi (wave emoji),
            please feel free to reach out. I'd love to hear about what you're working on and how I
            could help.
          </p>

          <p>
            I'm also currently looking for a new role as a Frontend Engineer and open to a wide
            range of opportunities. My preference would be to work remotely... But I'd also be happy
            to hear about opportunites that don't fit that description. I'm a hard-working and
            positive person who will always approach each task with a sense of purpose and attention
            to detail. Please, do feel free to check out my online profiles below and/or send me a
            message using the form below. I will do my best to respond in a timely manner. (smile
            emoji)
          </p>

          <SocialLinks />
        </div>
      </div>
    </section>

    <section class="container">
      <div class="flex flex-col gap-8 md:flex-row">
        <h2 class="flex-1 text-4xl font-semibold tracking-tight text-blue-600">Contact Me</h2>

        <ContactForm client:load />
      </div>
    </section>
  </main>
</RootLayout>
