---
import { getCollection } from "astro:content";
import { dateline } from "@/helpers/datetime";
import { Icon } from "astro-icon/components";
import type { HTMLAttributes } from "astro/types";
import Container from "../atoms/container.astro";
import Link from "../atoms/link.astro";
import Time from "../atoms/time.astro";
import NewsletterForm from "../molecules/newsletter-form.astro";

type Props = HTMLAttributes<"footer">;

const { class: className, ...rest } = Astro.props;

const socials = await getCollection(
  "socials",
  ({ id }) => !["discord", "youtube"].includes(id),
);

const routes = {
  general: [
    { href: "/", text: "Home" },
    { href: "/about-me", text: "About Me" },
    { href: "/blog", text: "Blog" },
    { href: "/projects", text: "Projects" },
    { href: "/dashboard", text: "Dashboard" },
  ],
  specifics: [
    { href: "/tags", text: "Tags" },
    { href: "/resume.pdf", text: "Resume" },
    { href: "/newsletter", text: "Newsletter" },
    { href: "/legal/privacy-policy", text: "Privacy Policy" },
    { href: "/legal/terms-of-service", text: "Terms of Service" },
  ],
  extras: [
    { href: "/resources", text: "Setup" },
    { href: "/tweets", text: "Tweets" },
    { href: "/sponsor-me", text: "Sponsor Me" },
    { href: "/hire-me", text: "Hire Me" },
    { href: "/contact-me", text: "Contact Me" },
  ],
};

const formatter = dateline("en-US", {
  month: "long",
  day: "numeric",
  hour: "numeric",
  minute: "numeric",
});

const buildDate = new Date(Date.now());
---

<footer {...rest} class:list={["pt-16", className]}>
  <Container>
    <nav
      aria-label="Footer"
      class="grid grid-cols-3 gap-x-4 gap-y-12 border-t border-gray-300 py-10 md:grid-cols-6"
    >
      <section class="col-span-1">
        <h4 class="text-sm uppercase text-gray-900 sm:text-base">General</h4>
        <ul class="mt-4 space-y-3 text-xs text-gray-600 sm:text-sm">
          {
            routes.general.map((route) => (
              <li>
                <Link href={route.href} class="text-inherit">
                  {route.text}
                </Link>
              </li>
            ))
          }
        </ul>
      </section>

      <section class="col-span-1">
        <h4 class="text-sm uppercase text-gray-900 sm:text-base">Specifics</h4>
        <ul class="mt-4 space-y-3 text-xs text-gray-600 sm:text-sm">
          {
            routes.specifics.map((route) => (
              <li>
                <Link href={route.href} class="text-inherit">
                  {route.text}
                </Link>
              </li>
            ))
          }
        </ul>
      </section>

      <section class="col-span-1">
        <h4 class="text-sm uppercase text-gray-900 sm:text-base">Extra</h4>
        <ul class="mt-4 space-y-3 text-xs text-gray-600 sm:text-sm">
          {
            routes.extras.map((route) => (
              <li>
                <Link href={route.href} class="text-inherit">
                  {route.text}
                </Link>
              </li>
            ))
          }
        </ul>
      </section>

      <section class="col-span-3">
        <NewsletterForm />
      </section>
    </nav>

    <div
      class="flex flex-col items-center justify-between gap-4 py-16 md:flex-row"
    >
      <div class="order-1 flex items-center gap-4 text-2xl md:order-2">
        {
          socials.map((link) => (
            <Link
              href={link.data.href}
              class:list={[
                "group flex items-center transition",
                "text-xl text-gray-800 hocus:text-gray-500",
              ]}
            >
              <Icon name={link.data.icon} class="" />
              <span class="sr-only">{link.data.text}</span>
            </Link>
          ))
        }
      </div>

      <p class="order-2 text-xs text-gray-800 md:order-1">
        <Time datetime={buildDate.toISOString()}>
          &copy; {buildDate.getFullYear()}
        </Time>
        <span>Prince Muel. All Rights Reserved</span>
      </p>
    </div>
  </Container>

  <div class="bg-gray-200">
    <Container class="flex items-center justify-center py-1">
      <p
        class="flex flex-wrap content-center items-center gap-1 text-xs text-gray-800"
      >
        <span>Built with </span>
        <Icon name="logos:astro-icon" />
        <Link href="https://docs.astro.build/en/concepts/why-astro/"
          >{Astro.generator}</Link
        > on
        <Time datetime={buildDate.toISOString()}
          >{formatter.format(buildDate)}</Time
        >
      </p>
    </Container>
  </div>
</footer>
